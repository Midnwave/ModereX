<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ModereX Control Panel</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Background -->
  <canvas id="bgCanvas"></canvas>
  <div class="bg-aurora"></div>
  <div class="bg-lines"></div>
  <div class="bg-noise"></div>
  
  <!-- Auth Overlay -->
  <div class="authOverlay" id="authOverlay">
    <div class="authBox">
      <div class="logo logo-img"><img src="537154108207028818e303ef9465c1f66717660d_96.png" alt="ModereX logo"></div>
      <h2>ModereX Control Panel</h2>
      <p>Connect to your Minecraft server's moderation interface.</p>

      <!-- Server Connection -->
      <div class="auth-section">
        <label class="auth-label">Server Connection</label>
        <div class="auth-row">
          <input type="text" class="input" id="serverHost" placeholder="Server Host" value="localhost" style="flex:2">
          <input type="number" class="input" id="serverPort" placeholder="Port" value="8765" style="flex:1;max-width:100px">
        </div>
      </div>

      <!-- Auth Mode Selector -->
      <div class="auth-section">
        <label class="auth-label">Authentication Method</label>
        <select class="input" id="authModeSelect">
          <option value="">Select method...</option>
          <option value="minecraft">In-Game Connect Code</option>
          <option value="console">Console (Username)</option>
        </select>
      </div>

      <!-- Minecraft Auth Section -->
      <div class="auth-section" id="authMinecraftSection" style="display:none">
        <label class="auth-label">Connect Code</label>
        <p class="auth-hint">Run <code>/mx connect</code> in-game to get your code</p>
        <input type="text" class="input code-input" id="connectCode" placeholder="XXXXXX" maxlength="6" autocomplete="off" spellcheck="false">
      </div>

      <!-- Console Auth Section -->
      <div class="auth-section" id="authConsoleSection" style="display:none">
        <label class="auth-label">Minecraft Username</label>
        <p class="auth-hint">Your account must have <code>moderex.webpanel</code> permission</p>
        <input type="text" class="input" id="consoleUsername" placeholder="YourUsername" maxlength="16" autocomplete="off" spellcheck="false">
      </div>

      <!-- Error Message -->
      <div class="auth-error" id="authError" style="display:none"></div>

      <!-- Status -->
      <div class="auth-status" id="authStatus"></div>

      <!-- Auth Button -->
      <button class="btn primary" id="authBtn" style="margin-top:16px"><i class="fa-solid fa-right-to-bracket"></i> Connect</button>

      <!-- Demo Mode -->
      <button class="btn ghost" style="margin-top:10px" onclick="demoToken()"><i class="fa-solid fa-flask"></i> Demo Mode</button>
    </div>
  </div>

  <!-- Access Denied Overlay -->
  <div class="accessDeniedOverlay" id="accessDeniedOverlay">
    <div class="accessDeniedBox">
      <div class="logo logo-img"><img src="537154108207028818e303ef9465c1f66717660d_96.png" alt="ModereX logo"></div>
      <h2>Access Denied</h2>
      <p>You do not have permission to access the ModereX Control Panel.</p>
      <p class="auth-hint">Contact your server administrator if you believe this is an error.</p>
      <button class="btn ghost" style="margin-top:20px" onclick="location.reload()"><i class="fa-solid fa-rotate-right"></i> Try Again</button>
    </div>
  </div>

  <!-- Connecting Overlay -->
  <div class="connectOverlay" id="connectOverlay">
    <div class="connectBox">
      <div class="spinner large"></div>
      <p id="connectingText">Connecting...</p>
    </div>
  </div>
  
  <!-- Main App -->
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sb-head">
      <div class="logo logo-img"><img src="537154108207028818e303ef9465c1f66717660d_96.png" alt="ModereX logo"></div>
        <div class="brand">
          <b>ModereX</b>
        </div>
      </div>
      
      <div class="sb-scroll" id="sbScroll">
        <div class="sb-group">
          <div class="sb-label">Overview</div>
          <div class="sb-item active" data-page="dashboard"><i class="fa-solid fa-gauge-high"></i> Dashboard</div>
        </div>
        
        <div class="sb-group">
          <div class="sb-label">Enforcement</div>
          <div class="sb-item" data-page="players"><i class="fa-solid fa-users"></i> Player Management</div>
          <div class="sb-item" data-page="punishments"><i class="fa-solid fa-gavel"></i> Punishments</div>
          <div class="sb-item" data-page="templates"><i class="fa-solid fa-bookmark"></i> Templates</div>
        </div>
        
        <div class="sb-group">
          <div class="sb-label">Monitoring</div>
          <div class="sb-item" data-page="automod"><i class="fa-solid fa-robot"></i> Automod Rules</div>
          <div class="sb-item" data-page="anticheat"><i class="fa-solid fa-shield-halved"></i> Anticheat</div>
          <div class="sb-item" data-page="watchlist"><i class="fa-solid fa-eye"></i> Watchlist</div>
          <div class="sb-item" data-page="livelogs"><i class="fa-solid fa-terminal"></i> Live Logs</div>
        </div>

        <div class="sb-group">
          <div class="sb-label">Communication</div>
          <div class="sb-item" data-page="staffchat"><i class="fa-solid fa-comments"></i> Staff Chat</div>
        </div>

        <div class="sb-group">
          <div class="sb-label">Configuration</div>
          <div class="sb-item" data-page="messages"><i class="fa-solid fa-language"></i> Messages</div>
          <div class="sb-item" data-page="settings"><i class="fa-solid fa-sliders"></i> Settings</div>
          <div class="sb-item" data-page="integrations"><i class="fa-solid fa-plug"></i> Integrations</div>
        </div>
      </div>
      
      <div class="sb-foot">
        <div class="status-card">
          <div class="status-left">
            <small>Server Status</small>
            <div class="status-pill"><span class="dot" id="statusDot"></span> <span id="statusText">Online</span></div>
          </div>
          <span class="chip ok" id="serverChip"><i class="fa-solid fa-server"></i> 1.21.4</span>
        </div>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main">
      <!-- Topbar -->
      <header class="topbar">
        <div class="gsearch">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input type="text" id="globalSearch" placeholder="Search players, cases, settings... (Ctrl+K)">
        </div>
        
        <div class="top-actions">
          <span class="chip info sim-note" id="simNote"><i class="fa-solid fa-flask"></i> Simulated data</span>
          <span class="chip" id="timeChip"><i class="fa-regular fa-clock"></i> --:--</span>
          <span class="chip warn" id="unsavedChip" style="display:none"><i class="fa-solid fa-triangle-exclamation"></i> Unsaved Changes</span>
          <button class="btn primary" id="publishBtn" onclick="publishSettings()"><i class="fa-solid fa-cloud-arrow-up"></i> Publish</button>
          <div class="top-profile" id="topProfile" style="display:none">
            <div class="profile-avatar"><img id="topAvatar" src="" alt=""></div>
            <div class="profile-meta">
              <div class="profile-name" id="topName">Player</div>
              <div class="profile-sub" id="topPlatform">Java</div>
            </div>
          </div>
        </div>
      </header>
      
      <!-- Content Area -->
      <div class="content">
        
        <!-- Dashboard Page -->
        <section class="page active" id="page-dashboard">
          <div class="page-head">
            <div class="page-title">
              <h1>Dashboard</h1>
              <p>Server moderation overview and recent activity summary.</p>
            </div>
          </div>
          
          <div class="panel pad">
            <div class="grid cols-4">
              <div class="stat">
                <small>Active Punishments</small>
                <b id="statActivePun">0</b>
                <div class="hint" id="statPunHint">No active cases</div>
                <i class="fa-solid fa-gavel icon"></i>
              </div>
              <div class="stat">
                <small>Automod Events</small>
                <b id="statAuto">0</b>
                <div class="hint" id="statAutoHint">No events</div>
                <i class="fa-solid fa-robot icon"></i>
              </div>
              <div class="stat">
                <small>Watchlist Alerts</small>
                <b id="statWatch">0</b>
                <div class="hint" id="statWatchHint">None</div>
                <i class="fa-solid fa-eye icon"></i>
              </div>
              <div class="stat">
                <small>Players Online</small>
                <b id="statOnline">0</b>
                <div class="hint" id="statOnlineHint">0/0 total</div>
                <i class="fa-solid fa-users icon"></i>
              </div>
            </div>
            
            <div class="grid cols-2wide" style="margin-top:20px">
              <div class="card">
                <h3><i class="fa-solid fa-clock-rotate-left" style="color:var(--primary-light)"></i> Recent Activity</h3>
                <p>Latest moderation actions and system events.</p>
                <div class="table-wrap" style="margin-top:12px;max-height:280px;overflow:auto">
                  <table>
                    <thead><tr><th>Time</th><th>Actor</th><th>Action</th><th>Target</th></tr></thead>
                    <tbody id="activityRows"></tbody>
                  </table>
                </div>
              </div>
              
              <div class="card">
                <h3><i class="fa-solid fa-compass" style="color:var(--accent-light)"></i> Navigation</h3>
                <p>Access primary management interfaces.</p>
                <div class="block" style="margin-top:12px">
                  <button class="btn" onclick="go('players')"><i class="fa-solid fa-users"></i> Player Management</button>
                  <button class="btn" onclick="go('punishments')"><i class="fa-solid fa-gavel"></i> Punishments</button>
                  <button class="btn" onclick="go('automod')"><i class="fa-solid fa-robot"></i> Automod Rules</button>
                  <button class="btn" onclick="go('watchlist')"><i class="fa-solid fa-eye"></i> Watchlist</button>
                </div>
              </div>
            </div>
            
            <div class="card">
              <h3><i class="fa-solid fa-eye" style="color:var(--warn)"></i> Watchlist Highlights</h3>
              <p>Players currently under active monitoring.</p>
              <div id="watchlistHighlights" style="margin-top:12px;display:flex;flex-direction:column;gap:10px;max-height:280px;overflow:auto"></div>
            </div>
          </div>
        </section>
        
        <!-- Players Page -->
        <section class="page" id="page-players">
          <div class="page-head">
            <div class="page-title">
              <h1>Player Management</h1>
              <p>View and manage all registered players on the server.</p>
            </div>
            <span class="chip ok" id="playersOnlineChip"><i class="fa-solid fa-users"></i> 0 online</span>
          </div>
          
          <div class="panel pad">
            <div class="toolbar" style="margin-top:0">
              <div class="left">
            <div class="gsearch" style="width:100%;max-width:560px">
              <i class="fa-solid fa-magnifying-glass"></i>
              <input type="text" id="playerSearch" placeholder="Search by name, UUID, IP...">
            </div>
              </div>
            </div>
            
            <div class="table-wrap" style="margin-top:16px;max-height:600px;overflow:auto">
              <table>
                <thead>
                  <tr>
                    <th>Player</th>
                    <th>Platform</th>
                    <th>Status</th>
                    <th>Last Seen</th>
                    <th class="flag-cell">Flags</th>
                    <th style="text-align:right">Actions</th>
                  </tr>
                </thead>
                <tbody id="playerRows"></tbody>
              </table>
            </div>
          </div>
        </section>
        
        <!-- Punishments Page -->
        <section class="page" id="page-punishments">
          <div class="page-head">
            <div class="page-title">
              <h1>Punishment History</h1>
              <p>View and manage all enforcement actions.</p>
            </div>
            <button class="btn primary" onclick="openPunishFromList()"><i class="fa-solid fa-gavel"></i> Punish Player</button>
          </div>
          
          <div class="panel pad">
            <div class="toolbar" style="margin-top:0">
              <div class="left">
                <div class="gsearch" style="width:100%;max-width:400px">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" id="punishSearch" placeholder="Search cases...">
                </div>
              </div>
              <div class="right">
                <div class="filter-group">
                  <button class="filter-btn active ban" id="filterBan" onclick="togglePunishFilter('BAN')"><i class="fa-solid fa-ban"></i> Ban</button>
                  <button class="filter-btn active mute" id="filterMute" onclick="togglePunishFilter('MUTE')"><i class="fa-solid fa-volume-xmark"></i> Mute</button>
                  <button class="filter-btn active warn" id="filterWarn" onclick="togglePunishFilter('WARN')"><i class="fa-solid fa-triangle-exclamation"></i> Warn</button>
                  <button class="filter-btn active kick" id="filterKick" onclick="togglePunishFilter('KICK')"><i class="fa-solid fa-person-walking-arrow-right"></i> Kick</button>
                </div>
              </div>
            </div>
            
            <div class="table-wrap" style="margin-top:16px;max-height:600px;overflow:auto">
              <table>
                <thead>
                  <tr>
                    <th>Player</th>
                    <th>Case ID</th>
                    <th>Type</th>
                    <th>Reason</th>
                    <th>Date</th>
                    <th>Duration</th>
                    <th>Staff</th>
                    <th style="text-align:right">Actions</th>
                  </tr>
                </thead>
                <tbody id="punishRows"></tbody>
              </table>
            </div>
          </div>
        </section>
        
        <!-- Templates Page -->
        <section class="page" id="page-templates">
          <div class="page-head">
            <div class="page-title">
              <h1>Punishment Templates</h1>
              <p>Pre-configured enforcement actions for quick application.</p>
            </div>
            <button class="btn primary" onclick="createTemplateUI()"><i class="fa-solid fa-plus"></i> Create Template</button>
          </div>
          
          <div class="panel pad">
            <div class="toolbar" style="margin-top:0">
              <div class="left">
                <div class="gsearch" style="width:100%;max-width:400px">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" id="templateSearch" placeholder="Search templates...">
                </div>
              </div>
            </div>
            
            <div class="table-wrap" style="margin-top:16px">
              <table>
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Duration</th>
                    <th>Reason</th>
                    <th style="text-align:right">Actions</th>
                  </tr>
                </thead>
                <tbody id="templateRows"></tbody>
              </table>
            </div>
          </div>
        </section>
        
        <!-- Automod Page -->
        <section class="page" id="page-automod">
          <div class="page-head">
            <div class="page-title">
              <h1>Automod Rules</h1>
              <p>Configure automated moderation triggers and responses.</p>
            </div>
            <div style="display:flex;gap:10px">
              <button class="btn" onclick="toggleTesterPanel()"><i class="fa-solid fa-flask"></i> Automod Tester</button>
              <button class="btn primary" onclick="addRuleUI()"><i class="fa-solid fa-plus"></i> Add Rule</button>
            </div>
          </div>
          
          <div class="panel pad">
            <div class="card rules-embed" style="margin:0">
              <h3><i class="fa-solid fa-robot" style="color:var(--primary-light)"></i> Rule Library</h3>
              <p>Each rule can block the message and optionally auto-punish.</p>
              <div id="rulesList" style="display:flex;flex-direction:column;gap:16px;margin-top:12px;max-height:520px;overflow:auto"></div>
            </div>
          </div>
        </section>
        
        <!-- Watchlist Page -->
        <section class="page" id="page-watchlist">
          <div class="page-head">
            <div class="page-title">
              <h1>Watchlist</h1>
              <p>Monitor specific players and receive alerts on their activity.</p>
            </div>
            <div style="display:flex;gap:10px;align-items:center">
              <div class="toggle-wrap">
                <button class="toggle" id="watchToastsToggle" onclick="toggleWatchToasts()"><span class="toggle-thumb"></span></button>
                <div class="toggle-meta">
                  <div class="toggle-title">Watchlist Toasts</div>
                  <div class="toggle-sub" id="watchToastsHint">On</div>
                </div>
              </div>
              <button class="btn bad" onclick="clearWatchAlerts()"><i class="fa-solid fa-trash"></i> Clear Alerts</button>
            </div>
          </div>
          
          <div class="panel pad">
            <div class="toolbar" style="margin-top:0">
              <div class="left">
                <div class="gsearch" style="width:100%;max-width:400px">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" id="watchSearch" placeholder="Search watchlist...">
                </div>
              </div>
              <div class="right" style="margin-left:auto">
                <button class="btn primary" onclick="openWatchlistPicker()"><i class="fa-solid fa-plus"></i> Add Player</button>
              </div>
            </div>
            
            <div class="grid cols-2" style="margin-top:20px">
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-eye" style="color:var(--warn)"></i> Monitored Players</h3>
                <div id="watchPlayers" style="margin-top:12px;display:flex;flex-direction:column;gap:10px;max-height:400px;overflow:auto"></div>
              </div>
              
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-bell" style="color:var(--bad)"></i> Recent Alerts</h3>
                <div id="watchAlerts" style="margin-top:12px;display:flex;flex-direction:column;gap:10px;max-height:400px;overflow:auto"></div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Live Logs Page -->
        <section class="page" id="page-livelogs">
          <div class="page-head">
            <div class="page-title">
              <h1>Live Logs</h1>
              <p>Real-time server event stream and activity monitor.</p>
            </div>
            <div style="display:flex;gap:10px;align-items:center">
              <button class="btn bad" onclick="clearLogs()"><i class="fa-solid fa-trash"></i> Clear</button>
            </div>
          </div>
          
          <div class="panel pad">
            <div class="toolbar" style="margin-top:0">
              <div class="left">
                <div class="gsearch" style="width:100%;max-width:400px">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" id="logsSearch" placeholder="Filter logs...">
                </div>
              </div>
              <div class="right">
                <button class="btn" id="logsFilterBtn" onclick="openLogsFilterPanel()"><i class="fa-solid fa-sliders"></i> Filters</button>
                <select class="input" id="logsPageSize" style="width:110px">
                  <option value="50">50 / page</option>
                  <option value="100" selected>100 / page</option>
                  <option value="200">200 / page</option>
                </select>
                <div class="page-controls">
                  <button class="mini" id="logsPrev" onclick="logsPrevPage()"><i class="fa-solid fa-chevron-left"></i></button>
                  <span class="chip" id="logsPageInfo">1 / 1</span>
                  <button class="mini" id="logsNext" onclick="logsNextPage()"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
              </div>
            </div>
            
            <div class="logsBox" id="logsBox" style="margin-top:16px"></div>
          </div>
        </section>

        <!-- Staff Chat Page -->
        <section class="page" id="page-staffchat">
          <div class="page-head">
            <div class="page-title">
              <h1>Staff Chat</h1>
              <p>Communicate with your moderation team in real-time.</p>
            </div>
            <span class="chip ok" id="staffOnlineChip"><i class="fa-solid fa-users"></i> <span id="staffOnlineCount">0</span> staff online</span>
          </div>

          <div class="panel pad">
            <div class="grid cols-3wide">
              <div class="card staffchat-container" style="margin:0">
                <div class="staffchat-messages" id="staffchatMessages">
                  <div class="staffchat-empty">
                    <i class="fa-solid fa-comments"></i>
                    <p>No messages yet. Start the conversation!</p>
                  </div>
                </div>
                <div class="staffchat-input">
                  <input type="text" class="input" id="staffchatInput" placeholder="Type a message to staff..." autocomplete="off">
                  <button class="btn primary" id="staffchatSend" onclick="sendStaffChat()">
                    <i class="fa-solid fa-paper-plane"></i>
                  </button>
                </div>
              </div>

              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-users" style="color:var(--primary-light)"></i> Online Staff</h3>
                <p>Team members currently available.</p>
                <div id="staffOnlineList" style="margin-top:14px">
                  <div class="staff-member">
                    <div class="profile-avatar"><img src="https://mc-heads.net/avatar/MHF_Steve/32" alt=""></div>
                    <div class="staff-meta">
                      <div class="staff-name">Waiting...</div>
                      <div class="staff-role">Connect to see staff</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Messages Page -->
        <section class="page" id="page-messages">
          <div class="page-head">
            <div class="page-title">
              <h1>Messages &amp; Localization</h1>
              <p>Configure plugin messages and language settings.</p>
            </div>
            <button class="btn" onclick="resetLang()"><i class="fa-solid fa-rotate-left"></i> Reset to Default</button>
          </div>
          
          <div class="panel pad">
            <div class="toolbar" style="margin-top:0">
              <div class="left">
                <select class="input" id="langSelect" onchange="setLanguage(this.value)" style="width:180px">
                  <option value="en_US">English (US)</option>
                  <option value="es_ES">Espa√±ol</option>
                  <option value="de_DE">Deutsch</option>
                </select>
                <div class="gsearch" style="width:100%;max-width:400px">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" id="msgSearch" placeholder="Search message keys...">
                </div>
              </div>
            </div>
            
            <div class="grid cols-2" style="margin-top:20px">
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-list" style="color:var(--primary-light)"></i> Message Keys</h3>
                <div class="table-wrap" style="margin-top:12px;max-height:400px;overflow:auto">
                  <table>
                    <thead><tr><th>Key</th><th>Value</th></tr></thead>
                    <tbody id="msgRows"></tbody>
                  </table>
                </div>
              </div>
              
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-eye" style="color:var(--accent-light)"></i> Ban Screen Preview</h3>
                <pre id="banPreview" style="margin-top:12px;padding:16px;background:rgba(0,0,0,.3);border-radius:var(--radius);font-family:var(--font-mono);font-size:12px;white-space:pre-wrap;color:var(--text-secondary);border:1px solid var(--border)"></pre>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Settings Page -->
        <section class="page" id="page-settings">
          <div class="page-head">
            <div class="page-title">
              <h1>Settings</h1>
              <p>Plugin configuration, chat controls, and punishment behavior.</p>
            </div>
          </div>
          
          <div class="panel pad">
            <div class="grid cols-3">
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-lock" style="color:var(--bad)"></i> Chat Lockdown</h3>
                <p>Disable chat for all non-staff players.</p>
                <div class="toggle-wrap" style="margin-top:14px">
                  <button class="toggle" id="togChat" onclick="toggleSetting('chatDisabled')"><span class="toggle-thumb"></span></button>
                  <div class="toggle-meta">
                    <div class="toggle-title">Chat Disabled</div>
                    <div class="toggle-sub" id="togChatHint">Off</div>
                  </div>
                </div>
              </div>
              
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-hourglass-half" style="color:var(--warn)"></i> Slowmode</h3>
                <p>Limit message frequency for all players.</p>
                <div class="toggle-wrap" style="margin-top:14px">
                  <button class="toggle" id="togSlow" onclick="toggleSetting('slowEnabled')"><span class="toggle-thumb"></span></button>
                  <div class="toggle-meta">
                    <div class="toggle-title">Slowmode Enabled</div>
                    <div class="toggle-sub" id="togSlowHint">On</div>
                  </div>
                </div>
                <div class="block" style="margin-top:10px">
                  <input type="number" class="input" id="slowSeconds" value="3" min="1" max="120" style="width:120px">
                  <span style="font-size:13px;color:var(--text-secondary)">seconds</span>
                </div>
              </div>
              
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-broom" style="color:var(--ok)"></i> Clear Chat</h3>
                <p>Remove all visible messages from chat.</p>
                <div class="block" style="margin-top:14px">
                  <button class="btn bad" onclick="clearChatNow()"><i class="fa-solid fa-trash"></i> Clear Now</button>
                </div>
              </div>
            </div>

            <div class="grid cols-2" style="margin-top:20px">
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-triangle-exclamation" style="color:var(--warn)"></i> Warn Settings</h3>
                <p>Configure how warning events are surfaced to staff.</p>
                <div class="toggle-wrap" style="margin-top:14px">
                  <button class="toggle" id="warnNotifyToggle" onclick="toggleSetting('warnNotify')"><span class="toggle-thumb"></span></button>
                  <div class="toggle-meta">
                    <div class="toggle-title">Notify on Warn</div>
                    <div class="toggle-sub" id="warnNotifyHint">On</div>
                  </div>
                </div>
                <div class="toggle-wrap" style="margin-top:12px">
                  <button class="toggle" id="warnEscalateToggle" onclick="toggleSetting('warnAutoEscalate')"><span class="toggle-thumb"></span></button>
                  <div class="toggle-meta">
                    <div class="toggle-title">Auto Escalate</div>
                    <div class="toggle-sub" id="warnEscalateHint">Off</div>
                  </div>
                </div>
              </div>

              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-volume-xmark" style="color:var(--primary-light)"></i> Mute Settings</h3>
                <p>Define what muted players can do.</p>
                <div class="grid cols-2" style="margin-top:14px">
                  <div class="toggle-wrap">
                    <button class="toggle" id="muteChatToggle" onclick="toggleSetting('muteChat')"><span class="toggle-thumb"></span></button>
                    <div class="toggle-meta"><div class="toggle-title">Chat</div></div>
                  </div>
                  <div class="toggle-wrap">
                    <button class="toggle" id="muteMsgToggle" onclick="toggleSetting('muteMsg')"><span class="toggle-thumb"></span></button>
                    <div class="toggle-meta"><div class="toggle-title">/msg &amp; Whisper</div></div>
                  </div>
                  <div class="toggle-wrap">
                    <button class="toggle" id="muteSignsToggle" onclick="toggleSetting('muteSigns')"><span class="toggle-thumb"></span></button>
                    <div class="toggle-meta"><div class="toggle-title">Signs</div></div>
                  </div>
                  <div class="toggle-wrap">
                    <button class="toggle" id="muteBooksToggle" onclick="toggleSetting('muteBooks')"><span class="toggle-thumb"></span></button>
                    <div class="toggle-meta"><div class="toggle-title">Books</div></div>
                  </div>
                  <div class="toggle-wrap">
                    <button class="toggle" id="muteBroadcastToggle" onclick="toggleSetting('muteBroadcast')"><span class="toggle-thumb"></span></button>
                    <div class="toggle-meta"><div class="toggle-title">Broadcast</div></div>
                  </div>
                  <div class="toggle-wrap">
                    <button class="toggle" id="muteVoiceToggle" onclick="toggleSetting('muteVoice')"><span class="toggle-thumb"></span></button>
                    <div class="toggle-meta"><div class="toggle-title">Voice Chat</div></div>
                  </div>
                  <div class="toggle-wrap">
                    <button class="toggle" id="muteVoiceJoinToggle" onclick="toggleSetting('muteVoiceJoin')"><span class="toggle-thumb"></span></button>
                    <div class="toggle-meta"><div class="toggle-title">Voice Join</div></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card" style="margin-top:20px">
              <h3><i class="fa-solid fa-shield-halved" style="color:var(--accent-light)"></i> Anticheat Integration</h3>
              <p>Replace anticheat alerts with ModereX alerts.</p>
              <div class="toggle-wrap" style="margin-top:12px">
                <button class="toggle" id="anticheatReplaceToggle" onclick="toggleSetting('anticheatReplace')"><span class="toggle-thumb"></span></button>
                <div class="toggle-meta">
                  <div class="toggle-title">Replace Anticheat Alerts</div>
                  <div class="toggle-sub" id="anticheatReplaceHint">Off</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Anticheat Page -->
        <section class="page" id="page-anticheat">
          <div class="page-head">
            <div class="page-title">
              <h1>Anticheat Alert Settings</h1>
              <p>Configure which anticheat checks you receive alerts for.</p>
            </div>
            <div style="display:flex;gap:10px;align-items:center">
              <span class="chip info" id="anticheatCountChip"><i class="fa-solid fa-shield-halved"></i> <span id="anticheatCheckCount">0</span> checks detected</span>
            </div>
          </div>

          <div class="panel pad">
            <div class="card" id="anticheatNoHooksCard" style="margin:0;display:none">
              <h3><i class="fa-solid fa-shield-halved" style="color:var(--warn)"></i> No Anticheats Detected</h3>
              <p>No anticheat plugins are currently hooked. Supported anticheats: Grim, Vulcan, Matrix, Spartan, NCP, Themis, FoxAddition, LightAC</p>
            </div>

            <div id="anticheatConfig">
              <div class="toolbar" style="margin-top:0">
                <div class="left">
                  <div class="gsearch" style="width:100%;max-width:420px">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="anticheatSearch" placeholder="Search checks...">
                  </div>
                </div>
                <div class="right">
                  <div id="anticheatBadges" style="display:flex;gap:6px"></div>
                </div>
              </div>

              <div class="table-wrap" style="margin-top:16px;max-height:520px;overflow:auto">
                <table>
                  <thead>
                    <tr>
                      <th>Anticheat</th>
                      <th>Check</th>
                      <th>Alert Level</th>
                      <th>Threshold</th>
                      <th>Time Window</th>
                    </tr>
                  </thead>
                  <tbody id="anticheatRows"></tbody>
                </table>
              </div>

              <div class="card" style="margin-top:16px">
                <h3><i class="fa-solid fa-circle-info" style="color:var(--primary-light)"></i> How it works</h3>
                <p style="margin-top:8px;color:var(--text-secondary);font-size:13px">
                  <b>Alert Level:</b> Choose when to receive alerts - Everyone (all players), Watchlist Only (only watched players), or Off (no alerts).<br>
                  <b>Threshold:</b> Number of violations required before you receive an alert.<br>
                  <b>Time Window:</b> The threshold must be met within this time period (in seconds).<br><br>
                  <i>Unconfigured checks (gray) will not send you any alerts. Click a row to configure.</i>
                </p>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Integrations Page -->
        <section class="page" id="page-integrations">
          <div class="page-head">
            <div class="page-title">
              <h1>Integrations</h1>
              <p>Configure external service connections and webhooks.</p>
            </div>
          </div>
          
          <div class="panel pad">
            <div class="card" style="margin:0">
              <h3><i class="fa-brands fa-discord" style="color:#5865F2"></i> Discord Webhook</h3>
              <p>Send moderation notifications to a Discord channel.</p>
              <div style="margin-top:14px">
                <div class="hintline" style="margin-top:0">Webhook URL</div>
                <input type="text" class="input" id="discordWebhook" placeholder="https://discord.com/api/webhooks/...">
              </div>
              <div class="grid cols-2" style="margin-top:14px" id="webhookToggles"></div>
              <div class="block" style="margin-top:14px">
                <button class="btn primary" onclick="saveIntegrations()"><i class="fa-solid fa-floppy-disk"></i> Save</button>
                <button class="btn" onclick="testWebhook()"><i class="fa-solid fa-paper-plane"></i> Test Webhook</button>
              </div>
            </div>
            
            <div class="card">
              <h3><i class="fa-solid fa-eye" style="color:var(--primary-light)"></i> Webhook Preview</h3>
              <pre id="webhookPreview" style="margin-top:12px;padding:16px;background:rgba(0,0,0,.3);border-radius:var(--radius);font-family:var(--font-mono);font-size:12px;white-space:pre-wrap;color:var(--text-secondary);border:1px solid var(--border)"></pre>
            </div>

            <div class="grid cols-2" style="margin-top:20px">
              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-microphone" style="color:var(--primary-light)"></i> Simple Voice Chat</h3>
                <p>Sync voice events with ModereX mute controls.</p>
                <div class="hintline">Status: <span class="badge gray" id="voiceChatStatus">Not detected</span></div>
              </div>

              <div class="card" style="margin:0">
                <h3><i class="fa-solid fa-user-shield" style="color:var(--accent-light)"></i> LuckPerms</h3>
                <p>Use group permissions for escalation policies.</p>
                <div class="hintline">Status: <span class="badge gray" id="luckPermsStatus">Not detected</span></div>
              </div>
            </div>

            <div class="card">
              <h3><i class="fa-solid fa-shield-halved" style="color:var(--warn)"></i> Anticheat Detection</h3>
              <p>Detected plugins (simulated).</p>
              <div id="anticheatList" style="margin-top:12px;display:flex;flex-wrap:wrap;gap:8px"></div>
            </div>
          </div>
        </section>
        
      </div>
    </main>
  </div>
  
  <!-- Player Drawer -->
  <div class="drawerOverlay" id="drawerOverlay" onclick="closeDrawer()"></div>
  <div class="drawer" id="playerDrawer">
    <div class="drawer-top">
      <div class="left player-profile">
        <div class="phead" style="width:42px;height:42px"><img id="drawerAvatar" src="" alt=""></div>
        <div>
          <b id="drawerName">Player</b>
          <div id="drawerMeta" style="font-size:11px;color:var(--text-secondary);margin-top:2px"></div>
        </div>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <div class="toggle-wrap">
          <button class="toggle" id="watchToggleBtn" onclick="toggleWatchlistSelected()" aria-pressed="false">
            <span class="toggle-thumb"></span>
          </button>
          <div class="toggle-meta">
            <div class="toggle-title">Watchlist</div>
            <div class="toggle-sub" id="watchToggleHint">Not watching</div>
          </div>
        </div>
        <button class="mini" onclick="closeDrawer()"><i class="fa-solid fa-xmark"></i></button>
      </div>
    </div>
    <div class="drawer-actionbar" id="drawerActionBar"></div>
    <div class="drawer-body">
      <div class="drawer-sec">
        <h3>Active Punishments</h3>
        <div class="box" id="drawerActivePun"></div>
      </div>
      <div class="drawer-sec">
        <h3>Past Violations</h3>
        <div class="box" id="drawerViolations"></div>
      </div>
      <div class="drawer-sec">
        <h3>Pardons</h3>
        <div class="box" id="drawerPardons"></div>
      </div>
      <div class="drawer-sec">
        <h3>IP Information</h3>
        <div class="box" id="drawerIps"></div>
      </div>
      <div class="drawer-sec">
        <h3>Recent Commands</h3>
        <div class="box" id="drawerRecent"></div>
      </div>
      <div class="drawer-sec">
        <h3>Automod Logs</h3>
        <div class="box" id="drawerAutomod"></div>
      </div>
    </div>
  </div>
  
  <!-- Punish Modal -->
  <div class="overlay" id="punishOverlay">
      <div class="modal punish-modal" onclick="event.stopPropagation()">
        <div class="modal-top">
          <div style="display:flex;align-items:center;gap:10px">
            <i class="fa-solid fa-gavel" style="color:var(--warn)"></i>
          <b id="punishTitle">Punish Player</b>
          </div>
          <button class="mini" onclick="closePunishModal()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body">
        <div class="grid cols-2" style="margin-top:0">
          <div>
            <div class="hintline" style="margin-top:0">Punishment</div>
            <select class="input" id="punishTypeSelect">
              <option value="WARN">Warn</option>
              <option value="MUTE">Mute</option>
              <option value="BAN">Ban</option>
              <option value="KICK">Kick</option>
            </select>
          </div>
          <div>
            <div class="hintline" style="margin-top:0">Target Player</div>
            <select class="input" id="punishTarget"></select>
          </div>
        </div>

        <div class="grid cols-2" style="margin-top:12px">
          <div>
            <div class="hintline" style="margin-top:0">Template</div>
            <select class="input" id="punishTemplate"></select>
          </div>
          <div>
            <div class="hintline" style="margin-top:0">Duration</div>
            <input type="text" class="input" id="punishDuration" placeholder="e.g. 7d, 1h, perm">
          </div>
        </div>
        
        <div style="margin-top:16px">
          <div class="hintline" style="margin-top:0">Reason</div>
          <textarea class="input" id="punishReason" placeholder="Enter reason for punishment..." rows="2"></textarea>
        </div>
        
        <div style="margin-top:16px">
          <div class="hintline" style="margin-top:0">Attach Evidence</div>
          <select class="input" id="punishEvidencePick">
            <option value="">(none)</option>
          </select>
          <div class="card" id="punishEvidencePreview" style="max-height:160px;overflow:auto">
            <span style="color:var(--muted)">No evidence attached.</span>
          </div>
        </div>
      </div>
      <div class="modal-foot">
        <span class="badge gray"><i class="fa-solid fa-circle-info"></i> Review before submitting</span>
        <div style="display:flex;gap:10px">
          <button class="btn ghost" onclick="closePunishModal()"><i class="fa-solid fa-xmark"></i> Cancel</button>
          <button class="btn primary" onclick="submitPunishment()"><i class="fa-solid fa-check"></i> Execute</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Punish Create Modal -->
  <div class="overlay" id="punishCreateOverlay">
    <div class="modal punish-modal" onclick="event.stopPropagation()">
      <div class="modal-top">
        <div style="display:flex;align-items:center;gap:10px">
          <i class="fa-solid fa-gavel" style="color:var(--warn)"></i>
          <b id="punishCreateTitle">WARN -= Select Player</b>
        </div>
        <button class="mini" onclick="closePunishCreateModal()"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="modal-body">
        <div>
          <div class="hintline" style="margin-top:0">Target Player</div>
          <div class="combo">
            <input type="text" class="input" id="punishCreatePlayer" placeholder="Type a player name...">
            <div class="combo-list" id="punishCreateList"></div>
          </div>
        </div>

        <div class="grid cols-2" style="margin-top:12px">
          <div>
            <div class="hintline" style="margin-top:0">Punishment</div>
            <select class="input" id="punishCreateType">
              <option value="WARN">Warn</option>
              <option value="MUTE">Mute</option>
              <option value="BAN">Ban</option>
              <option value="KICK">Kick</option>
            </select>
          </div>
          <div>
            <div class="hintline" style="margin-top:0">Template</div>
            <select class="input" id="punishCreateTemplate"></select>
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="hintline" style="margin-top:0">Duration</div>
          <input type="text" class="input" id="punishCreateDuration" placeholder="e.g. 7d, 1h, perm">
        </div>

        <div style="margin-top:16px">
          <div class="hintline" style="margin-top:0">Reason</div>
          <textarea class="input" id="punishCreateReason" placeholder="Enter reason for punishment..." rows="2"></textarea>
        </div>

        <div style="margin-top:16px">
          <div class="hintline" style="margin-top:0">Attach Evidence</div>
          <select class="input" id="punishCreateEvidencePick">
            <option value="">(none)</option>
          </select>
          <div class="card" id="punishCreateEvidencePreview" style="max-height:160px;overflow:auto">
            <span style="color:var(--muted)">No evidence attached.</span>
          </div>
        </div>
      </div>
      <div class="modal-foot">
        <span class="badge gray"><i class="fa-solid fa-circle-info"></i> Review before submitting</span>
        <div style="display:flex;gap:10px">
          <button class="btn ghost" onclick="closePunishCreateModal()"><i class="fa-solid fa-xmark"></i> Cancel</button>
          <button class="btn primary" onclick="submitPunishCreate()"><i class="fa-solid fa-check"></i> Execute</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Details Modal -->
  <div class="overlay" id="detailsOverlay">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-top">
        <div style="display:flex;align-items:center;gap:10px">
          <i class="fa-solid fa-file-lines" style="color:var(--primary-light)"></i>
          <b>Punishment Details</b>
          <span class="badge gray" id="detailsCaseId"><i class="fa-solid fa-hashtag"></i> --------</span>
        </div>
        <button class="mini" onclick="closeDetailsModal()"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="modal-body" id="detailsBody"></div>
      <div class="modal-foot">
        <span class="badge gray"><i class="fa-solid fa-circle-info"></i> Case Information</span>
        <div style="display:flex;gap:10px" id="detailsActions">
          <button class="btn ghost" onclick="closeDetailsModal()"><i class="fa-solid fa-xmark"></i> Close</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Wizard Modal -->
  <div class="overlay" id="wizardOverlay">
    <div class="modal" style="max-width:640px" onclick="event.stopPropagation()">
      <div class="modal-top">
        <div style="display:flex;align-items:center;gap:10px">
          <i class="fa-solid fa-wand-magic-sparkles" style="color:var(--accent-light)"></i>
          <b>Setup Wizard</b>
          <span class="badge gray" id="wizStepChip"><i class="fa-solid fa-list-check"></i> Step 1/5</span>
        </div>
        <button class="mini" onclick="closeWizard()"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="modal-body" id="wizardBody"></div>
      <div class="modal-foot">
        <span class="badge gray" id="wizardHint"><i class="fa-solid fa-circle-info"></i> Configuration</span>
        <div style="display:flex;gap:10px">
          <button class="btn ghost" onclick="wizardBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>
          <button class="btn primary" onclick="wizardNext()"><i class="fa-solid fa-arrow-right"></i> Next</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- AI Panel -->
  <button class="fab" id="aiFab" onclick="toggleAi()"><i class="fa-solid fa-robot"></i></button>
  <div class="aiPanel" id="aiPanel">
    <div class="aiTop">
      <div style="display:flex;align-items:center;gap:10px">
        <i class="fa-solid fa-robot" style="color:var(--accent-light)"></i>
        <b>AI Assistant</b>
      </div>
      <button class="mini" onclick="aiClear()"><i class="fa-solid fa-trash"></i></button>
    </div>
    <div class="aiBody" id="aiBody">
      <div class="aiMsg bot">Hello! I'm the ModereX AI assistant. How can I help you manage your server today?</div>
    </div>
    <div class="aiFoot">
      <input type="text" class="input" id="aiInput" placeholder="Ask something...">
      <button class="btn primary" onclick="aiSend()"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>

  <!-- Automod Tester Panel -->
  <div class="testerPanel" id="testerPanel">
    <div class="testerTop">
      <div style="display:flex;align-items:center;gap:10px">
        <i class="fa-solid fa-flask" style="color:var(--accent-light)"></i>
        <b>Automod Tester</b>
      </div>
      <button class="mini" onclick="toggleTesterPanel()"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="testerBody">
      <div class="hintline" style="margin-top:0">Channel</div>
      <select class="input" id="testChannel">
        <option>global</option>
        <option>trade</option>
        <option>party</option>
        <option>staff</option>
      </select>
      <div class="hintline">Test Message</div>
      <div style="display:flex;gap:8px">
        <input class="input" id="testMessage" placeholder="Enter test message...">
        <button class="mini" onclick="seedTestMsg()"><i class="fa-solid fa-shuffle"></i></button>
      </div>
      <div class="block" style="margin-top:12px">
        <button class="btn primary" onclick="runRuleTest()"><i class="fa-solid fa-play"></i> Run Test</button>
        <button class="btn" onclick="saveRules()"><i class="fa-solid fa-floppy-disk"></i> Save Rules</button>
      </div>
      <div class="card" id="testResult" style="margin-top:12px">
        <span style="color:var(--muted)">Enter a message and run the test to see matching rules.</span>
      </div>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div id="toastContainer"></div>

  <!-- Connect Overlay -->
  <div class="overlay connect-overlay" id="connectOverlay">
    <div class="connect-modal" onclick="event.stopPropagation()">
      <div class="spinner"></div>
      <div class="connect-title">Connecting to server...</div>
      <div class="connect-sub">Establishing secure session</div>
    </div>
  </div>
  
  <!-- Scripts (load in order: utils -> state -> ui -> app) -->
  <script src="js/utils.js"></script>
  <script src="js/websocket.js"></script>
  <script src="js/state.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
