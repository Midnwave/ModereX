package zoruafan.foxanticheat.checks.misc.exploits;

import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.entity.Projectile;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.ProjectileLaunchEvent;
import zoruafan.foxanticheat.api.events.FoxFlagEvent;
import zoruafan.foxanticheat.manager.FilesManager;

public class BowBomb implements Listener {
   private final FilesManager file;

   public BowBomb(FilesManager files) {
      this.file = files;
   }

   @EventHandler(
      ignoreCancelled = true
   )
   public void onProjectileLaunch(ProjectileLaunchEvent event) {
      if (this.file.getChecks().getBoolean("misc.modules.exploits.modules.bowbomb.enable", true)) {
         if (event.getEntity() instanceof Player) {
            Player player = (Player)event.getEntity();
            if (!player.hasPermission("foxac.bypass.misc")) {
               Projectile entity = event.getEntity();
               if (entity != null) {
                  if (entity.getVelocity().lengthSquared() > 15.0D) {
                     FoxFlagEvent flagEvent = new FoxFlagEvent(player, "misc", 0, "Bowbom exploit!", "Exploits", "Bowbomb exploit!");
                     Bukkit.getPluginManager().callEvent(flagEvent);
                     if (!flagEvent.isCancelled()) {
                        event.setCancelled(true);
                        Bukkit.getLogger().warning("[AntiExploits] " + player.getName() + " has been detected for BowBomb.");
                     }
                  }

               }
            }
         }
      }
   }
}
