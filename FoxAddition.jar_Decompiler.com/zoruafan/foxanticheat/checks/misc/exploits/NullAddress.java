package zoruafan.foxanticheat.checks.misc.exploits;

import java.net.InetAddress;
import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerLoginEvent;
import org.bukkit.event.player.PlayerLoginEvent.Result;
import zoruafan.foxanticheat.api.events.FoxFlagEvent;
import zoruafan.foxanticheat.manager.FilesManager;

public class NullAddress implements Listener {
   private final FilesManager file;

   public NullAddress(FilesManager files) {
      this.file = files;
   }

   @EventHandler(
      priority = EventPriority.LOWEST
   )
   public void onPlayerLogin(PlayerLoginEvent event) {
      if (this.file.getChecks().getBoolean("misc.modules.exploits.modules.nulladdress.enable", true)) {
         Player player = event.getPlayer();
         InetAddress address = event.getAddress();
         if (address == null) {
            FoxFlagEvent flagEvent = new FoxFlagEvent(player, "misc", 0, "Invalid login IP address!", "Exploits", "Invalid login IP address!");
            Bukkit.getPluginManager().callEvent(flagEvent);
            if (!flagEvent.isCancelled()) {
               event.disallow(Result.KICK_OTHER, this.file.getLang("exploits.nulladdress", player));
               Bukkit.getLogger().warning("[AntiExploits] " + player.getName() + " has been disconnected for NullAddress.");
            }

         }
      }
   }
}
